#!/bin/bash -e

cachePath=cache/

git diff origin/main --name-status $cachePath | cut -f2 | xargs -r rm
bin/cache

if ! git diff --quiet --exit-code origin/main...HEAD $cachePath &> /dev/null; then
	echo "Cache isn't clean clean after updating it"
	git status
	exit 1
fi
